# 12.4 范围

通过范围可以选择文档中的一个区域，而不必考虑节点的界限（选择在后台完成，对用户是不可见的）；

在常规的DOM操作不能更有效地修改文档时，使用范围往往可以达到目的；

## DOM中的范围

createRange();

<pre>
<code>
var supportsRange = document.implementation.hasFeature("Range", "2.0");
var alsoSupportsRange = (typeof document.createRange == "function");
</code>
</pre>

每个范围由一个Range类型的实例表示;

1.startContainer：包含范围起点的节点（即选区中第一个节点的父节点）。

2.startOffset：

范围在startContainer中起点的偏移量。

如果startContainer是文本节点、注释节点或CDATA节点，

那么startOffset就是范围起点之前跳过的字符数量;

否则，startOffset就是范围中第一个子节点的索引。

3.endContainer：包含范围终点的节点（即选区中最后一个节点的父节点）。

4.endOffset：范围在endContainer 中终点的偏移量（与startOffset遵循相同的取值规则）。

5.commonAncestorContainer：startContainer和endContainer共同的祖先节点在文档树中位置最深的那个;

在把范围放到文档中特定的位置时，这些属性都会被赋值;

### 用DOM范围实现简单选择

selectNode(),selectNodeContents();

接受一个参数，即一个DOM 节点，然后使用该节点中的信息来填充范围；

selectNode()方法选择整个节点，包括其子节点；

selectNodeContents()方法则只选择节点的子节点；

此外还有setStartBefore（refNode），setStartAfter（refNode），setEndBefore（refNode），setEndAfter（refNode）；

在调用这些方法时，所有属性都会自动为你设置好；

不过，要想创建复杂的范围选区，也可以直接指定这些属性的值；

### 用DOM范围实现复杂选择

setStart(),setEnd();

接受两个参数：一个参照节点和一个偏移量值；

<pre>
<code>
var range1 = document.createRange();
range2 = document.createRange();
p1 = document.getElementById("p1");
p1Index = -1;
i, len;
for (i = 0, len = p1.parentNode.childNodes.length; i < len; i++) {
    if (p1.parentNode.childNodes[i] == p1) {
        p1Index = i;
        break;
    }
}
range1.setStart(p1.parentNode, p1Index);
range1.setEnd(p1.parentNode, p1Index + 1);
range2.setStart(p1, 0);
range2.setEnd(p1, p1.childNodes.length);
</code>
</pre>

模仿selectNode()和selectNodeContents()并不是setStart()和setEnd()的主要用途，

它们更胜一筹的地方在于能够选择节点的一部分。

<pre>
<code>
<!DOCTYPE html>
<html>
<body>
<p id="p1"><b>Hello</b> world!</p>
//            01234    0123456
</body>
</html>

var p1 = document.getElementById("p1");
helloNode = p1.firstChild.firstChild;
worldNode = p1.lastChild;

var range = document.createRange();
range.setStart(helloNode, 2);
rang e.setEnd(worldNode, 3);
</code>
</pre>

从"Hello"的"llo"到"world!"的"o";

### 操作DOM范围中的内容

deleteContents(),删除范围包含的内容；

与deleteContents()方法相似，extractContents()也会从文档中移除范围选区；

但这两个方法的区别在于，extractContents()会返回范围的文档片段。

利用这个返回的值，可以将范围的内容插入到文档中的其他地方；

<pre>
<code>
var p1 = document.getElementById("p1");
helloNode = p1.firstChild.firstChild;
worldNode = p1.lastChild;
range = document.createRange();
range.setStart(helloNode, 2);
range.setEnd(worldNode, 3);
var fragment = range.extractContents();
p1.parentNode.appendChild(fragment);

// 结果
<p><b>He</b>rld!</p>
<b>llo</b> wo
</code>
</pre>

cloneContents()创建范围对象的一个副本,然后在文档的其他地方插入该副本；

<pre>
<code>
var p1 = document.getElementById("p1"),
    helloNode = p1.firstChild.firstChild,
    worldNode = p1.lastChild,
    range = document.createRange();
range.setStart(helloNode, 2);
range.setEnd(worldNode, 3);
var fragment = range.cloneContents();
p1.parentNode.appendChild(fragment);

// 结果
<p><b>Hello</b> world!</p>
<b>llo</b> wo
</code>
</pre>

### 插入DOM范围中的内容

insertNode()向范围选区的开始处插入一个节点;

